jQuery(document).ready(function($){$("a#dgd_library_button").click(function(e){var insertImage=wp.media.controller.Library.extend({defaults:_.defaults({id:"insert-image",title:"Insert Image Url",allowLocalEdits:true,displaySettings:true,displayUserSettings:true,multiple:true,type:"image"},wp.media.controller.Library.prototype.defaults)});var frame=wp.media({button:{text:"Select"},state:"insert-image",states:[new insertImage]});frame.on("close",function(){var selection=frame.state("insert-image").get("selection");if(!selection.length){}});frame.on("select",function(){var state=frame.state("insert-image");var selection=state.get("selection");var imageArray=[];console.log(selection);if(!selection){return}selection.each(function(attachment){var display=state.display(attachment).toJSON();var obj_attachment=attachment.toJSON();var caption=obj_attachment.caption,options,html;if(!wp.media.view.settings.captions){delete obj_attachment.caption}display=wp.media.string.props(display,obj_attachment);options={id:obj_attachment.id,post_content:obj_attachment.description,post_excerpt:caption};if(display.linkUrl){options.url=display.linkUrl}if("image"===obj_attachment.type){html=wp.media.string.image(display);_.each({align:"align",size:"image-size",alt:"image_alt"},function(option,prop){if(display[prop]){options[option]=display[prop]}})}else if("video"===obj_attachment.type){html=wp.media.string.video(display,obj_attachment)}else if("audio"===obj_attachment.type){html=wp.media.string.audio(display,obj_attachment)}else{html=wp.media.string.link(display);options.post_title=display.title}attachment.attributes["nonce"]=wp.media.view.settings.nonce.sendToEditor;attachment.attributes["attachment"]=options;attachment.attributes["html"]=html;attachment.attributes["post_id"]=wp.media.view.settings.post.id;if(attachment.attributes["sizes"]["fts_thumb"]){var ftgImageThumb=attachment.attributes["sizes"]["fts_thumb"]["url"]}else{var ftgImageThumb=attachment.attributes["sizes"]["thumbnail"]["url"]}jQuery("#img1plupload-thumbs").prepend('<li class="thumb" id="list_item_'+attachment.id+'" data-image-id="'+attachment.id+'"><img src="'+ftgImageThumb+'" alt="" /><div class="clear"></div></li>');jQuery.ajax({data:{action:"fts_edit_image_ajax",id:attachment.id,postID:jQuery("#img1plupload-thumbs").attr("data-post-id"),nonce:"attach_image"},type:"post",url:ssAjax.ajaxurl,success:function(response){console.log("Well Done and got this from sever: "+response)},error:function(){alert("Error, please contact us at https://slickremix.com/ for help.")}})})});frame.on("open",function(){var selection=frame.state("insert-image").get("selection");selection.each(function(image){var attachment=wp.media.attachment(image.attributes.id);attachment.fetch();selection.remove(attachment?[attachment]:[])})});frame.open()});if(jQuery("div.ft-gallery-popup-form").hasClass("ftg-premium-active")){jQuery('<div id="ftg-watermark-logo-wrap"></div>').insertAfter("#ft-watermark-image")}$("input#ft-watermark-image").click(function(e){e.preventDefault();var frame=wp.media({id:"dgd_featured_image",title:dgd_strings.panel.title,multiple:false,library:{type:"image"},button:{text:dgd_strings.panel.button}});frame.on("select",function(){var attachment=frame.state().get("selection").first().toJSON();jQuery("#ft_watermark_image_input").val(attachment.url);jQuery("#ft_watermark_image_id").val(attachment.id);jQuery("#ftg-watermark-logo-wrap").html('<img src="'+attachment.url+'" class="ft-watermark-image-thumb" /><br/>');jQuery.ajax({data:{action:"fts_update_image_ajax",id:attachment.id,nonce:attachment.id,fts_img_remove:"true"},type:"POST",url:ssAjax.ajaxurl,beforeSend:function(){},success:function(response){console.log("Well Done and got this from sever: "+response)},error:function(){alert("Error, please contact us at https://www.slickremix.com/support for help.")}});return false});frame.open()});if(jQuery("#ft-watermark-image").val()!==""){jQuery("#ftg-watermark-logo-wrap").html('<img src="'+jQuery("#ft_watermark_image_input").val()+'" class="ft-watermark-image-thumb ft-watermark-existing" /><br/>')}$("a.wp-post-thumbnail").live("click",function(e){parent.tb_remove();parent.location.reload(1)});$("a#insert-media-button").live("click",function(){if(typeof wp!=="undefined"){var editor_id=$(".wp-media-buttons:eq(0) .add_media").attr("data-editor");var frame=wp.media.editor.get(editor_id);frame="undefined"!=typeof frame?frame:wp.media.editor.add(editor_id);if(frame){frame.on("select",function(){var currentState=frame.state();if(currentState.id==="featured-image"){doFetchFeaturedImage()}})}}});jQuery("#img1plupload-thumbs").sortable({items:"li",opacity:1,cursor:"move",update:function(){var id=jQuery(this).data("post-id");var ordr=jQuery(this).sortable("serialize")+"&post_id="+id+"&action=list_update_order";jQuery.post(ajaxurl,ordr,function(response){console.log(response);console.log(id);console.log(ordr)})}})});jQuery.fn.exists=function(){return jQuery(this).length>0};jQuery(document).ready(function($){if($(".plupload-upload-uic").exists()){var pconfig=false;$(".plupload-upload-uic").each(function(){var $this=$(this);var id1=$this.attr("id");var imgId=id1.replace("plupload-upload-ui","");plu_show_thumbs(imgId);pconfig=JSON.parse(JSON.stringify(base_plupload_config));pconfig["browse_button"]=imgId+pconfig["browse_button"];pconfig["container"]=imgId+pconfig["container"];pconfig["drop_element"]=pconfig["drop_element"];pconfig["file_data_name"]=imgId+pconfig["file_data_name"];pconfig["multipart_params"]["imgid"]=imgId;pconfig["multipart_params"]["_ajax_nonce"]=$this.find(".ajaxnonceplu").attr("id").replace("ajaxnonceplu","");if($this.hasClass("plupload-upload-uic-multiple")){pconfig["multi_selection"]=true}if($this.find(".plupload-resize").exists()){var w=parseInt($this.find(".plupload-width").attr("id").replace("plupload-width",""));var h=parseInt($this.find(".plupload-height").attr("id").replace("plupload-height",""));pconfig["resize"]={width:w,height:h,quality:100}}var uploader=new plupload.Uploader(pconfig);uploader.bind("Init",function(up){var uploaddiv=$("#plupload-upload-ui");if(up.features.dragdrop){uploaddiv.addClass("drag-drop");$("#drag-drop-area").bind("dragover.wp-uploader",function(){uploaddiv.addClass("drag-over")}).bind("dragleave.wp-uploader, drop.wp-uploader",function(){uploaddiv.removeClass("drag-over")})}else{uploaddiv.removeClass("drag-drop");$("#drag-drop-area").unbind(".wp-uploader")}});uploader.init();uploader.bind("FilesAdded",function(up,files){$.each(files,function(i,file){$this.find(".filelist").append('<div class="file" id="'+file.id+'"><b>'+file.name+'</b> (<span class="ftg-file-size">'+plupload.formatSize(0)+"</span>/"+plupload.formatSize(file.size)+") "+' <span class="ftg-finishing"></span><div class="fileprogress"></div></div>')});up.refresh();up.start()});uploader.bind("UploadProgress",function(up,file){$("#"+file.id+" .fileprogress").width(file.percent+"%");$("#"+file.id+" span.ftg-file-size").html(plupload.formatSize(parseInt(file.size*file.percent/100)));setTimeout(function(){if(file.percent==100){$("#"+file.id+" span.ftg-finishing").html("<strong>Finishing up, please be patient</strong>")}},5e3)});uploader.bind("FileUploaded",function(up,file,response){$("#"+file.id).fadeOut();$("#"+file.id).addClass("ftg-upload-complete");response=JSON.parse(response["response"]);if($this.hasClass("plupload-upload-uic-multiple")){var v1=$.trim($("#"+imgId).val());if(v1){v1=response["url"]}else{v1=response["url"]}$("#"+imgId).val(v1)}else{$("#"+imgId).val(response["url"]+"")}plu_show_thumbs(imgId,response["id"]);var ftgGlobalValue=jQuery("select#fts_image_to_woo_model_prod").val();var ftgLandscapeValue=jQuery("select#fts_landscape_to_woo_model_prod").val();var ftgSquareValue=jQuery("select#fts_square_to_woo_model_prod").val();var ftgPortraitValue=jQuery("select#fts_portrait_to_woo_model_prod").val();var ftgorientationValueCheck=jQuery("#fts_smart_image_orient_prod").is(":checked");console.log(ftgGlobalValue);if(jQuery("#uploaderSection").hasClass("ftg-auto-create-product-on-upload")||jQuery("#fts_auto_image_woo_prod").is(":checked")){if(ftgGlobalValue||ftgLandscapeValue&&ftgSquareValue&&ftgPortraitValue&&ftgorientationValueCheck){fts_image_to_woo_on_upload(response["id"],jQuery("#img1plupload-thumbs").attr("data-post-id"));jQuery("#ftg-tab-content1 .ft-gallery-notice").removeClass("error");jQuery("#ftg-tab-content1 .ft-gallery-notice").removeClass("ftg-block");jQuery("#ftg-tab-content1 .ft-gallery-notice").html("")}else{jQuery("#ftg-tab-content1 .ft-gallery-notice").addClass("error");jQuery("#ftg-tab-content1 .ft-gallery-notice").addClass("ftg-block");jQuery("#ftg-tab-content1 .ft-gallery-notice").html(ftg_woo.must_have_option_selected_to_create_products+'<div class="ft-gallery-notice-close"></div>');console.log("error")}}else{var allDivs=jQuery(".file");var classedDivs=jQuery(".file.ftg-upload-complete");var allDivsHaveClass=allDivs.length===classedDivs.length;if(allDivsHaveClass){setTimeout(function(){jQuery("#ftg-tab-content1 .ft-gallery-notice").addClass("updated");jQuery("#ftg-tab-content1 .ft-gallery-notice").addClass("ftg-block");jQuery("#ftg-tab-content1 .ft-gallery-notice").html(updatefrombottomParams.images_complete_on_auto_upload);jQuery("#ftg-tab-content1 .ft-gallery-notice").append('<div class="ft-gallery-notice-close"></div>');console.log("made it")},500)}}})})}});function plu_show_thumbs(imgId,attachmentId){var $=jQuery;var thumbsC=$(".thumb");var attachID="list_item_"+attachmentId;var imagesS=$("#"+imgId).val();var images=imagesS.split(",");for(var i=0;i<images.length;i++){if(images[i]){var thumb=$('<li class="thumb thumb-new" id="'+attachID+'"><img src="'+images[i]+'" alt="" /><div class="thumbi"><a id="thumbremovelink'+imgId+i+'" href="#" style="display: none">Delete</a></div> <div class="clear"></div></li>');$("#img1plupload-thumbs").prepend(thumb);thumb.find("a").click(function(){var ki=$(this).attr("id").replace("thumbremovelink"+attachID,"");ki=parseInt(ki);var kimages=[];imagesS=$("#"+attachID).val();images=imagesS.split(",");for(var j=0;j<images.length;j++){if(j!=ki){kimages[kimages.length]=images[j]}}return false})}}jQuery("#img1plupload-thumbs").sortable({items:"li",opacity:1,cursor:"move",update:function(){var id=jQuery(this).data("post-id");var ordr=jQuery(this).sortable("serialize")+"&action=list_update_order";jQuery.post(ajaxurl,ordr,function(response){console.log(response);console.log(id)})}});thumbsC.disableSelection()}